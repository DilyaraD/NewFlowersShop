@model Products
@{
    var reviews = ViewBag.Reviews as List<NewFlowersShop.Reviews>;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./img_s/logo.svg" type="image/icon-x" />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Irish+Grover&family=Marmelad&family=Rufina:wght@200;700&display=swap"
          rel="stylesheet" />
    <title>Новые цветы</title>
</head>
<body>
    <div class="productPage">
        <button>назад в каталог</button>
        <div class="infoProduct">
            <div class="sidebar2">
                <img src="./img_s/logo.svg" class="imageProductMain" />
            </div>
            <div class="content2">
                <h2 class="productNameMain">@Model.ProductName</h2>
                <h2 class="productNameMain">@Model.Price ₽</h2>
                <div class="info-row-Product2">
                    <span>Категория:</span>
                    <span class="value">@ViewBag.FlowerCategories</span>
                </div>
                <div class="info-row-Product2">
                    <span>Размер:</span>
                    <span class="value">@Model.Size</span>
                </div>
                <div class="info-row-Product2">
                    <span>Упаковка:</span>
                    <span class="value">@Model.Package</span>
                </div>
                <div class="info-row-Product2">
                    <span>Состав:</span>
                    <span class="value">
                        @if (ViewData["FlowerTypes"] != null)
                        {
                            <span>@ViewData["FlowerTypes"]</span>
                        }
                    </span>
                </div>

                <div class="info-row-Product2">
                    <span>В наличии:
                        @if (ViewData["Stores"] != null && ((List<string>)ViewData["Stores"]).Any())
                        {
                            <ul>
                                @foreach (var store in (List<string>)ViewData["Stores"])
                                {
                                    <li>@store</li>
                                }
                            </ul>
                        }
                        else
                        {
                            <span>Нет в наличии</span>
                        }
                    </span>
                </div>

                <div class="info-row-Product2">
                    <span>Количество:</span>
                </div>
                <div class="info-row-Product2">
                    <div class="quantity-controls">
                        <button>+</button><span>0</span><button>-</button>
                    </div>
                    <button>в корзину</button>
                </div>
            </div>
        </div>
        <div class="selectProduct">
            <button class="tab-button" data-tab="delivery">
                Доставка <span class="arrow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                    </svg>
                </span>
            </button>
            <button class="tab-button" data-tab="description">
                Описание <span class="arrow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                    </svg>
                </span>
            </button>
            <button class="tab-button" data-tab="reviews">
                Отзывы <span class="arrow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                    </svg>
                </span>
            </button>
        </div>

        <div class="tab-content" id="delivery" style="display: none;">
            <p>Букет будет готов в течение часа.  При получении в пункте выдачи сказать либо номер заказа, либо номер телефона.</p>
            <br />
            <p>Доставка курьером в течении 1 часа. Возможна доставка к точному времени и дате. Доставка по Казани в радиусе 5 км — БЕСПЛАТНО! Стоимость доставки в ночное время (с 20:00 до 09:00) увеличивается на 200 ₽.</p>
        </div>
        <div class="tab-content" id="description" style="display: none;">
            <div><p style="font-weight:1000;">Описание</p>
                <p>@Model.DescriptionProduct</p>
                </div>
                <br />
            <div>
                <p style="font-weight:1000;">Уход за растением</p>
                <p>@Model.CareDescription</p>
                </div>
        </div>
        <div class="tab-content" id="reviews" style="display: none;">
            @if (reviews != null && reviews.Any())
            {
                @foreach (var review in reviews)
                {
                    <div class="review" style="border: 1px solid black; padding: 10px; margin-bottom: 10px;">
                        <div class="review-header">
                            <span class="username">Пользователь цветочного магазина</span> <!-- Логин можно заменить на имя пользователя -->
                            <span class="review-date" style="font-size: 12px; color: gray;">@review.ReviewDate.ToString("dd.MM.yyyy")</span>
                        </div>

                        <div class="stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                <span class="star @(i <= review.Rating ? "filled" : "")">★</span>
                            }
                        </div>

                        <div class="review-text">
                            <p>@review.ReviewText</p>
                        </div>
                    </div>
                }
            }
            else
            {
                <p>Нет отзывов для этого товара.</p>
            }
        </div>

    </div>




    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                </div>
                <div class="modal-body">
                    <div id="messageBox" class="message" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ОК</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quantityDisplay = document.querySelector('.quantity-controls span');
            const incrementButton = document.querySelector('.quantity-controls button:first-of-type');
            const decrementButton = document.querySelector('.quantity-controls button:last-of-type');
            let quantity = 1;
            const maxQuantity = @ViewData["MaxQuantity"]; 

            if (quantityDisplay && incrementButton && decrementButton) {
                incrementButton.addEventListener('click', function () {
                    if (quantity < maxQuantity) {
                        quantity++;
                        quantityDisplay.textContent = quantity;
                    } else {
                        showMessage("Доступное количество товара: " + maxQuantity);
                    }
                });

                decrementButton.addEventListener('click', function () {
                    if (quantity > 1) {
                        quantity--;
                        quantityDisplay.textContent = quantity;
                    }
                });
            }
        });


        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.selectProduct .tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const tabId = this.dataset.tab;
                    const tabContent = document.getElementById(tabId);
                    const currentActive = document.querySelector('.selectProduct .tab-button.active');
                    if (currentActive) {
                        if (currentActive !== this) {
                            currentActive.classList.remove('active');
                            document.getElementById(currentActive.dataset.tab).style.display = 'none';

                            this.classList.add('active');
                            tabContent.style.display = 'block';
                        }
                        else {

                            this.classList.toggle('active');
                            tabContent.style.display = this.classList.contains('active') ? 'block' : 'none';
                        }

                    }
                    else {

                        this.classList.add('active');
                        tabContent.style.display = 'block';
                    }
                });
            });
        });
    </script>
</body>
</html>
